<!DOCTYPE html>
<html lang="en">
<head>
        <title>Careless Whisper - linux</title>
        <meta charset="utf-8" />
                <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
        <link href="../" type="application/atom+xml" rel="alternate" title="Careless Whisper ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="http://github.com/weiweiwang/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="..">Careless Whisper </a></h1>
                <nav><ul>
                                                                                        <li ><a href="../category/android.html">android</a></li>
                                    <li class="active"><a href="../category/linux.html">linux</a></li>
                                    <li ><a href="../category/misc.html">misc</a></li>
                                    <li ><a href="../category/programming.html">programming</a></li>
                                    <li ><a href="../category/search.html">search</a></li>
                                    <li ><a href="../category/sql_nosql.html">sql_nosql</a></li>
                                                    <li><a href="../tags.html">Tags</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
        
            <aside id="featured" class="body"><article>
                <h1 class="entry-title"><a href="../common-shell-command.html">常用shell命令</a></h1> 
                <footer class="post-info">
        <abbr class="published" title="2012-08-19T00:00:00">
                2012/八月/19 星期日
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/wangweiwei.html">wangweiwei</a>
        </address>
        <p>In <a href="../category/linux.html">linux</a>. </p>
<p>tags: <a href="../tag/bash.html">bash</a><a href="../tag/shell.html">shell</a><a href="../tag/log.html">log</a></p></p>
</footer><!-- /.post-info -->                <div class="toc">
<ul>
<li><a href="#_1">测试文件</a><ul>
<li><a href="#testtxt">test.txt</a></li>
</ul>
</li>
<li><a href="#sort">sort</a><ul>
<li><a href="#_2">常用参数说明</a></li>
<li><a href="#_3">举例</a></li>
</ul>
</li>
<li><a href="#uniq">uniq</a><ul>
<li><a href="#_4">常用参数说明</a></li>
<li><a href="#_5">举例</a></li>
</ul>
</li>
<li><a href="#join">join</a><ul>
<li><a href="#_6">常用参数说明</a></li>
<li><a href="#_7">举例</a></li>
</ul>
</li>
<li><a href="#awk">awk</a><ul>
<li><a href="#_8">常用参数说明</a></li>
<li><a href="#http-server">分析http server的处理速度</a></li>
<li><a href="#http">切割http请求参数的样例</a></li>
</ul>
</li>
<li><a href="#sed">sed</a><ul>
<li><a href="#_9">举例</a></li>
</ul>
</li>
<li><a href="#_10">需要注意的地方</a><ul>
<li><a href="#1txt">1.txt</a></li>
<li><a href="#2txt">2.txt</a></li>
<li><a href="#join-with-default-lang">join with default LANG</a></li>
<li><a href="#join-with-lc_allc">join with LC_ALL=C</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">测试文件</h1>
<h2 id="testtxt">test.txt</h2>
<pre><code>title
slug
category
tag
slug
tag
</code></pre>
<h1 id="sort">sort</h1>
<p>这个命令可以对文件或者输入流进行排序输出。</p>
<h2 id="_2">常用参数说明</h2>
<ul>
<li>-t 分隔符，通过这个可以将每一行分隔成若干字段，比如\t分隔的时候要传递-t $'\t'</li>
<li>-k 选择排序的字段，比如以第一个字段k1,1，以前两个字段排序的话就是-k1,2</li>
<li>-n 以数字排序而非字符串的字典序</li>
<li>-r 倒序排列</li>
</ul>
<h2 id="_3">举例</h2>
<pre><code>&gt;cat test.txt|sort -t $'\t' -k1,1 -r
title
tag
tag
slug
slug
category
</code></pre>
<h1 id="uniq">uniq</h1>
<p>这个命令可以统计文件中重复行，需要输入是排序过的。</p>
<h2 id="_4">常用参数说明</h2>
<ul>
<li>-f 表示跳过若干个字段，也就是这写字段不作为唯一性检查的key，分隔符是空白字符，无法指定</li>
<li>-s 表示跳过若干个字符</li>
<li>-c 打印重复行的数目</li>
<li>-i 忽略大小写</li>
<li>-d 只输出重复行</li>
<li>-u 只输出不同的行</li>
</ul>
<p>需要注意的是uniq输入需要是sort过的，否则结果不正确。</p>
<h2 id="_5">举例</h2>
<pre><code>&gt;cat test.txt|sort -t $'\t' -k1,1|uniq -c
1 title
2 tag
2 slug
1 category
</code></pre>
<h1 id="join">join</h1>
<p>这个命令可以join两个文件中的若干列，类似与mysql的join命令, 输入的文件需要是排序过的。</p>
<h2 id="_6">常用参数说明</h2>
<ul>
<li>-1 第一个文件的join字段</li>
<li>-2 第二个文件的join字段</li>
<li>-o 指定输出格式，每个字段的格式是M.N，M是文件编号1或者2,N是字段编号，从1开始。</li>
<li>-t 指定分隔符，类似与sort命令中的-t</li>
</ul>
<h2 id="_7">举例</h2>
<pre><code>&gt;sort test.txt &gt; 1.txt
&gt;head -1 1.txt &gt; 2.txt
&gt;join -1 1 -2 1 -o 1.1 2.1 -t $'\t' 1.txt  2.txt
category    category
</code></pre>
<h1 id="awk">awk</h1>
<p>awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk的处理文本和数据的方式是这样的，它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。awk分别代表其作者姓氏的第一个字母。因为它的作者是三个人，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面介绍的awk是以GUN的gawk为例的，在linux系统中已把awk链接到gawk，所以下面全部以awk进行介绍。以上文字摘自<a href="http://man.lupaworld.com/content/manage/ringkee/awk.htm">Awk学习笔记</a>。awk语法比上述命令复杂的多，所以学习的话可以参考上面的学习笔记，这里只举例说明下awk在文本分析上的用途。</p>
<h2 id="_8">常用参数说明</h2>
<ul>
<li>-F 指定字段分隔符，awk的字段从1开始，0表示整行。</li>
<li>-f 指定从文件读入awk代码，不是直接写在命令后面。</li>
<li>-v VAR=VAL 从外部向awk脚本传递参数</li>
</ul>
<h2 id="http-server">分析http server的处理速度</h2>
<p>假设我们的access.log每一行的字段使用-t分隔，第13个字段是每个请求的耗时,第七个字段是请求类型GET/POST。下面的脚本就可以统计GET请求的最大耗时，最小耗时,平均耗时，请求总数。</p>
<pre><code>awk -F'\t' 'BEGIN{max=0;min=1000000000;}$7 ~/GET/{if($13&gt;max)max=$13;if($13&lt;min)min=$13;sum+=$13;}END{print max,min,sum/NR,NR}' access.log
</code></pre>
<h2 id="http">切割http请求参数的样例</h2>
<pre><code>    {
     split($9,params,"&amp;");
     for(idx in params)
     {
       p=params[idx];
       i=index(p,"=")
       if(i&gt;0)
       {
         k=substr(p,1,i-1);
         v=substr(p,i+1);
         query[k]=v;
         print k"\t"v;
       };
     }
    }
</code></pre>
<h1 id="sed">sed</h1>
<p>sed是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed 3.02。以上文字摘自<a href="http://www.tsnc.edu.cn/tsnc_wgrj/doc/sed.htm">sed学习笔记</a>。sed语法也比较复杂，学习的话可以参考上面的sed学习笔记。</p>
<h2 id="_9">举例</h2>
<pre><code>sed 's/ubuntu/linux/g'
</code></pre>
<p>在整行范围内把ubuntu替换为linux。如果没有g标记，则只有每行第一个匹配的字符串会被替换。</p>
<h1 id="_10">需要注意的地方</h1>
<p>由于sort命令是基于当前字符集的，而不同字符集的字符大小排序和比较方式，所以经常会出现，sort后的join结果不正确的问题。举例:</p>
<h2 id="1txt">1.txt</h2>
<pre><code>1002547 14
10025472 14
1002549 15
10025492 15
</code></pre>
<h2 id="2txt">2.txt</h2>
<pre><code>10025471 01
1002547 14
10025473 01
10025476 01
1002549 135
10025492 115
10025498 135
</code></pre>
<h2 id="join-with-default-lang">join with default LANG</h2>
<pre><code>&gt;env|grep LANG
LANG=en_US.UTF-8
&gt;sort 1.txt &gt; 1.sort.txt
&gt;sort 2.txt &gt; 2.sort.txt
&gt;join 1.sort.txt 2.sort.txt
join: file 2 is not in sorted order
1002549 15 135
10025492 15 115
</code></pre>
<h2 id="join-with-lc_allc">join with LC_ALL=C</h2>
<pre><code>&gt;export LC_ALL=C
&gt;sort 1.txt &gt; 1.sort.txt
&gt;sort 2.txt &gt; 2.sort.txt
&gt;join 1.sort.txt 2.sort.txt
1002547 14 14
1002549 15 135
10025492 15 115
</code></pre>
                <p>There are <a href="../common-shell-command.html#disqus_thread">comments</a>.</p>                </article>
                </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
</section><!-- /#content -->
        <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://xieyu.github.com">Xieyu</a></li>
                                                    <li><a href="http://mindhacks.cn">刘未鹏</a></li>
                                                    <li><a href="http://blog.silentxyc.com/">薛亦晨</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="../" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://weibo.com/lolorosa">新浪微博</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://smashingmagazine.com">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-7072537-7");
    pageTracker._trackPageview();
    } catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'cloudornot';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>